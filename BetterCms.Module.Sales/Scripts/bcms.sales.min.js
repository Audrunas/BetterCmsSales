bettercms.define("bcms.sales",["bcms.jquery","bcms","bcms.siteSettings","bcms.dynamicContent","bcms.ko.extenders","bcms.ko.grid"],function(a,b,n,c,g,h){var l={},m={},i={loadSiteSettingsProductsUrl:null,loadProductsUrl:null,saveProductUrl:null,deleteProductUrl:null,loadSiteSettingsUnitsUrl:null,loadUnitsUrl:null,saveUnitUrl:null,deleteUnitUrl:null},d={deleteProductDialogTitle:null,deleteUnitDialogTitle:null};l.links=i;l.globalization=d;l.selectors=m;var j=(function(q){b.extendsClass(r,q);function r(s,v,t,x){q.call(this,s,i.loadProductsUrl,v,t);var w=this;w.units=[];if(x&&a.isArray(x)){for(var u=0;u<x.length;u++){w.units.push({id:x[u].Id,name:x[u].Title});}}}r.prototype.createItem=function(s){var t=new k(this,s);return t;};return r;})(h.ListViewModel);var k=(function(q){b.extendsClass(r,q);function r(t,s){q.call(this,t,s);var u=this;u.name=g.observable().extend({required:"",maxLength:{maxLength:g.maxLength.name}});u.unit=g.observable();u.unitName=g.observable();u.registerFields(u.name,u.unit);u.name(s.Name);u.unit(s.Unit);u.unitName(s.UnitName);}r.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteProductDialogTitle,this.name());};r.prototype.getSaveParams=function(){var s=q.prototype.getSaveParams.call(this);s.Name=this.name();s.Unit=this.unit()||(this.parent.units.length>0&&this.parent.units[0].id);return s;};return r;})(h.ItemViewModel);function e(t){var q=n.getMainContainer(),r=(t.Success==true)?t.Data:{};var u=new j(q,r.Items,r.GridOptions,r.Units);u.deleteUrl=i.deleteProductUrl;u.saveUrl=i.saveProductUrl;g.applyBindings(u,q.get(0));var s=q.find("input[type=text],textarea,select").filter(":visible:first");if(s){s.focus();}}l.loadSiteSettingsSalesProducts=function(){c.bindSiteSettings(n,i.loadSiteSettingsProductsUrl,{contentAvailable:e});};var o=(function(q){b.extendsClass(r,q);function r(s,u,t){q.call(this,s,i.loadUnitsUrl,u,t);}r.prototype.createItem=function(s){var t=new p(this,s);return t;};return r;})(h.ListViewModel);var p=(function(q){b.extendsClass(r,q);function r(t,s){q.call(this,t,s);var u=this;u.title=g.observable().extend({required:"",maxLength:{maxLength:g.maxLength.name}});u.shortTitle=g.observable().extend({required:"",maxLength:{maxLength:g.maxLength.name}});u.registerFields(u.title,u.shortTitle);u.title(s.Title);u.shortTitle(s.ShortTitle);}r.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteUnitDialogTitle,this.title());};r.prototype.getSaveParams=function(){var s=q.prototype.getSaveParams.call(this);s.Title=this.title();s.ShortTitle=this.shortTitle();return s;};return r;})(h.ItemViewModel);function f(t){var q=n.getMainContainer(),r=(t.Success==true)?t.Data:{};var u=new o(q,r.Items,r.GridOptions);u.deleteUrl=i.deleteUnitUrl;u.saveUrl=i.saveUnitUrl;g.applyBindings(u,q.get(0));var s=q.find("input[type=text],textarea,select").filter(":visible:first");if(s){s.focus();}}l.loadSiteSettingsSalesUnits=function(){c.bindSiteSettings(n,i.loadSiteSettingsUnitsUrl,{contentAvailable:f});};l.loadSiteSettingsSalesPartners=function(){alert("TODO");};l.init=function(){b.logger.debug("Initializing bcms.sales module.");};b.registerInit(l.init);return l;});