bettercms.define("bcms.sales",["bcms.jquery","bcms","bcms.siteSettings","bcms.dynamicContent","bcms.ko.extenders","bcms.ko.grid"],function(a,b,r,c,i,j){var p={},q={},k={loadSiteSettingsProductsUrl:null,loadProductsUrl:null,saveProductUrl:null,deleteProductUrl:null,loadSiteSettingsUnitsUrl:null,loadUnitsUrl:null,saveUnitUrl:null,deleteUnitUrl:null,loadSiteSettingsBuyersUrl:null,saveBuyerUrl:null,deleteBuyerUrl:null,loadBuyersUrl:null,loadSiteSettingsSuppliersUrl:null,saveSupplierUrl:null,deleteSupplierUrl:null,loadSuppliersUrl:null},d={deleteProductDialogTitle:null,deleteUnitDialogTitle:null,deleteBuyerDialogTitle:null,deleteSupplierDialogTitle:null,buyersTabTitle:null,suppliersTabTitle:null};p.links=k;p.globalization=d;p.selectors=q;var n=(function(u){b.extendsClass(v,u);function v(w,z,x,B){u.call(this,w,k.loadProductsUrl,z,x);var A=this;A.units=[];if(B&&a.isArray(B)){for(var y=0;y<B.length;y++){A.units.push({id:B[y].Id,name:B[y].Title});}}}v.prototype.createItem=function(w){var x=new o(this,w);if(this.units&&this.units.length>0&&!w.Unit&&!w.UnitName){x.unit(this.units[0].id);x.unitName(this.units[0].name);}return x;};return v;})(j.ListViewModel);var o=(function(u){b.extendsClass(v,u);function v(x,w){u.call(this,x,w);var y=this;y.name=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});y.unit=i.observable();y.unitName=i.observable();y.registerFields(y.name,y.unit);y.name(w.Name);y.unit(w.Unit);y.unitName(w.UnitName);}v.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteProductDialogTitle,this.name());};v.prototype.getSaveParams=function(){var w=u.prototype.getSaveParams.call(this);w.Name=this.name();w.Unit=this.unit();return w;};return v;})(j.ItemViewModel);function f(x){var u=r.getMainContainer(),v=(x.Success==true)?x.Data:{};var y=new n(u,v.Items,v.GridOptions,v.Units);y.deleteUrl=k.deleteProductUrl;y.saveUrl=k.saveProductUrl;i.applyBindings(y,u.get(0));var w=u.find("input[type=text],textarea,select").filter(":visible:first");if(w){w.focus();}}p.loadSiteSettingsSalesProducts=function(){c.bindSiteSettings(r,k.loadSiteSettingsProductsUrl,{contentAvailable:f});};var s=(function(u){b.extendsClass(v,u);function v(w,y,x){u.call(this,w,k.loadUnitsUrl,y,x);}v.prototype.createItem=function(w){var x=new t(this,w);return x;};return v;})(j.ListViewModel);var t=(function(u){b.extendsClass(v,u);function v(x,w){u.call(this,x,w);var y=this;y.title=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});y.shortTitle=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});y.registerFields(y.title,y.shortTitle);y.title(w.Title);y.shortTitle(w.ShortTitle);}v.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteUnitDialogTitle,this.title());};v.prototype.getSaveParams=function(){var w=u.prototype.getSaveParams.call(this);w.Title=this.title();w.ShortTitle=this.shortTitle();return w;};return v;})(j.ItemViewModel);function h(x){var u=r.getMainContainer(),v=(x.Success==true)?x.Data:{};var y=new s(u,v.Items,v.GridOptions);y.deleteUrl=k.deleteUnitUrl;y.saveUrl=k.saveUnitUrl;i.applyBindings(y,u.get(0));var w=u.find("input[type=text],textarea,select").filter(":visible:first");if(w){w.focus();}}p.loadSiteSettingsSalesUnits=function(){c.bindSiteSettings(r,k.loadSiteSettingsUnitsUrl,{contentAvailable:h});};var l=(function(u){b.extendsClass(v,u);function v(w,z,y,A,x){u.call(this,w,A,z,y);this.deleteConfirmationMessage=x;}v.prototype.createItem=function(w){var x=new m(this,w);return x;};return v;})(j.ListViewModel);var m=(function(u){b.extendsClass(v,u);function v(x,w){u.call(this,x,w);var y=this;y.name=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});y.email=i.observable().extend({email:"",maxLength:{maxLength:i.maxLength.email}});y.phoneNumber=i.observable().extend({maxLength:{maxLength:i.maxLength.name}});y.registerFields(y.name,y.email,y.phoneNumber);y.name(w.Name);y.email(w.Email);y.phoneNumber(w.PhoneNumber);}v.prototype.getDeleteConfirmationMessage=function(){return a.format(this.parent.deleteConfirmationMessage,this.name());};v.prototype.getSaveParams=function(){var w=u.prototype.getSaveParams.call(this);w.Name=this.name();w.Email=this.email();w.PhoneNumber=this.phoneNumber();return w;};return v;})(j.ItemViewModel);function e(u,x){var v=(x.Success==true)?x.Data:{};var y=new l(u,v.Items,v.GridOptions,k.loadBuyersUrl,d.deleteBuyerDialogTitle);y.deleteUrl=k.deleteBuyerUrl;y.saveUrl=k.saveBuyerUrl;i.applyBindings(y,u.get(0));var w=u.find("input[type=text],textarea,select").filter(":visible:first");if(w){w.focus();}}function g(u,x){var v=(x.Success==true)?x.Data:{};var y=new l(u,v.Items,v.GridOptions,k.loadSuppliersUrl,d.deleteSupplierDialogTitle);y.deleteUrl=k.deleteSupplierUrl;y.saveUrl=k.saveSupplierUrl;i.applyBindings(y,u.get(0));var w=u.find("input[type=text],textarea,select").filter(":visible:first");if(w){w.focus();}}p.loadSiteSettingsSalesPartners=function(){var x=[],v=function(y){var z=y.find("input[type=text],textarea,select").filter(":visible:first");if(z){z.focus();}};var u=new r.TabViewModel(d.buyersTabTitle,k.loadSiteSettingsBuyersUrl,e,v);x.push(u);var w=new r.TabViewModel(d.suppliersTabTitle,k.loadSiteSettingsSuppliersUrl,g,v);x.push(w);r.initContentTabs(x);};p.init=function(){b.logger.debug("Initializing bcms.sales module.");};b.registerInit(p.init);return p;});