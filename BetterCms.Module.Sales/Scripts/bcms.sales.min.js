bettercms.define("bcms.sales",["bcms.jquery","bcms","bcms.siteSettings","bcms.dynamicContent","bcms.ko.extenders","bcms.ko.grid"],function(a,b,p,c,i,j){var n={},o={},k={loadSiteSettingsProductsUrl:null,loadProductsUrl:null,saveProductUrl:null,deleteProductUrl:null,loadSiteSettingsUnitsUrl:null,loadUnitsUrl:null,saveUnitUrl:null,deleteUnitUrl:null,loadSiteSettingsBuyersUrl:null,loadSiteSettingsSuppliersUrl:null},d={deleteProductDialogTitle:null,deleteUnitDialogTitle:null,buyersTabTitle:null,suppliersTabTitle:null};n.links=k;n.globalization=d;n.selectors=o;var l=(function(s){b.extendsClass(t,s);function t(u,x,v,z){s.call(this,u,k.loadProductsUrl,x,v);var y=this;y.units=[];if(z&&a.isArray(z)){for(var w=0;w<z.length;w++){y.units.push({id:z[w].Id,name:z[w].Title});}}}t.prototype.createItem=function(u){var v=new m(this,u);if(this.units&&this.units.length>0&&!u.Unit&&!u.UnitName){v.unit(this.units[0].id);v.unitName(this.units[0].name);}return v;};return t;})(j.ListViewModel);var m=(function(s){b.extendsClass(t,s);function t(v,u){s.call(this,v,u);var w=this;w.name=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});w.unit=i.observable();w.unitName=i.observable();w.registerFields(w.name,w.unit);w.name(u.Name);w.unit(u.Unit);w.unitName(u.UnitName);}t.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteProductDialogTitle,this.name());};t.prototype.getSaveParams=function(){var u=s.prototype.getSaveParams.call(this);u.Name=this.name();u.Unit=this.unit();return u;};return t;})(j.ItemViewModel);function f(v){var s=p.getMainContainer(),t=(v.Success==true)?v.Data:{};var w=new l(s,t.Items,t.GridOptions,t.Units);w.deleteUrl=k.deleteProductUrl;w.saveUrl=k.saveProductUrl;i.applyBindings(w,s.get(0));var u=s.find("input[type=text],textarea,select").filter(":visible:first");if(u){u.focus();}}n.loadSiteSettingsSalesProducts=function(){c.bindSiteSettings(p,k.loadSiteSettingsProductsUrl,{contentAvailable:f});};var q=(function(s){b.extendsClass(t,s);function t(u,w,v){s.call(this,u,k.loadUnitsUrl,w,v);}t.prototype.createItem=function(u){var v=new r(this,u);return v;};return t;})(j.ListViewModel);var r=(function(s){b.extendsClass(t,s);function t(v,u){s.call(this,v,u);var w=this;w.title=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});w.shortTitle=i.observable().extend({required:"",maxLength:{maxLength:i.maxLength.name}});w.registerFields(w.title,w.shortTitle);w.title(u.Title);w.shortTitle(u.ShortTitle);}t.prototype.getDeleteConfirmationMessage=function(){return a.format(d.deleteUnitDialogTitle,this.title());};t.prototype.getSaveParams=function(){var u=s.prototype.getSaveParams.call(this);u.Title=this.title();u.ShortTitle=this.shortTitle();return u;};return t;})(j.ItemViewModel);function h(v){var s=p.getMainContainer(),t=(v.Success==true)?v.Data:{};var w=new q(s,t.Items,t.GridOptions);w.deleteUrl=k.deleteUnitUrl;w.saveUrl=k.saveUnitUrl;i.applyBindings(w,s.get(0));var u=s.find("input[type=text],textarea,select").filter(":visible:first");if(u){u.focus();}}n.loadSiteSettingsSalesUnits=function(){c.bindSiteSettings(p,k.loadSiteSettingsUnitsUrl,{contentAvailable:h});};function e(){}function g(){}n.loadSiteSettingsSalesPartners=function(){var v=[],t=function(w){var x=w.find("input[type=text],textarea,select").filter(":visible:first");if(x){x.focus();}};var s=new p.TabViewModel(d.buyersTabTitle,k.loadSiteSettingsBuyersUrl,e,t);v.push(s);var u=new p.TabViewModel(d.suppliersTabTitle,k.loadSiteSettingsSupplierUrl,g,t);v.push(u);};n.init=function(){b.logger.debug("Initializing bcms.sales module.");};b.registerInit(n.init);return n;});